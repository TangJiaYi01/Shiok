<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shiok!</title>
    <link rel="shortcut icon" href="./img/shiokie.png" />
    <link
      href="https://fonts.googleapis.com/css?family=Inter"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"
    />
    <script
      src="https://kit.fontawesome.com/825a35d965.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./style/main.css" />
    <link rel="stylesheet" href="./style/swipe.css" />
  </head>
  <body class="overflow-hidden flex flex-col">
    <header
      class="flex justify-between px-4 py-2 items-center measure md:max-w-lg mx-auto w-full h-[66px]"
    >
      <div class="icon aspect-square">
        <img
          src="https://raw.githubusercontent.com/UltraRaptorYT/SPIT/main/server/img/default.png"
          alt="profile pic"
          class="w-full h-full object-cover rounded-full"
        />
      </div>
      <div class="logo aspect-square">
        <img src="./img/logo.png" alt="logo" class="w-full h-full" />
      </div>
      <div class="icon aspect-square" id="shakerMove">
        <img
          src="./img/shaker.png"
          alt="shaker"
          class="w-full h-full"
          id="shaker"
        />
      </div>
    </header>
    <div
      class="flex justify-center flex-col items-center relative h-[calc(100dvh-66px)]"
    >
      <div class="frame"></div>
      <div
        class="icons flex w-full justify-around py-3 text-xl mt-auto max-w-[400px]"
        id="icons"
      >
        <button
          class="icon aspect-square rounded-full bg-slate-200 flex justify-center items-center p-2"
          id="return"
        >
          <i
            class="fa-solid fa-arrow-rotate-left text-xl text-amber-500"
            aria-hidden="true"
          ></i>
        </button>
        <button
          id="hate"
          class="icon aspect-square rounded-full bg-slate-200 flex justify-center items-center p-2"
        >
          <i class="fa-solid fa-xmark text-red-700" aria-hidden="true"></i>
        </button>
        <button
          class="icon aspect-square rounded-full bg-slate-200 flex justify-center items-center p-2 relative"
          id="moreInfo"
        >
          <i
            class="fa-solid fa-angle-up text-xl text-black"
            aria-hidden="true"
          ></i>
        </button>
        <button
          class="icon aspect-square rounded-full bg-slate-200 flex justify-center items-center p-2"
          id="like"
        >
          <i class="fa-solid fa-heart text-green-500" aria-hidden="true"></i>
        </button>
        <button
          id="dashboard"
          class="icon aspect-square rounded-full bg-slate-200 flex justify-center items-center p-2"
        >
          <img src="./img/shiokie.png" class="icon" />
        </button>
      </div>
    </div>
    <script>
      document.getElementById("dashboard").addEventListener("click", () => {
        window.location.href = "./dashboard.html";
      });

      let imgCount = 0;
      let checkCounter = 0;
      var data = {
        "Chicken Rice": {
          "Hong Yu's Chick":
            "https://upload.wikimedia.org/wikipedia/commons/thumb/7/71/Hainanese_Chicken_Rice.jpg/640px-Hainanese_Chicken_Rice.jpg",
          "Kaleb's Chick":
            "https://d1e1vgxjd1htwd.cloudfront.net/-/media/recipe-hainanese-chicken-rice.jpg?h=969&la=en&w=1250&hash=2AE75B9674FDE26B8978059DA848F8A888E2845C",
        },
        "Fried Chicken": {
          KFC: "https://cdn.discordapp.com/attachments/650387369706389517/1021125177255407678/image.png",
          "Texas Chicken":
            "https://assets.grab.com/wp-content/uploads/sites/8/2019/03/12143755/Texas-Chicken-Chicken-Combo-delivery-kl-700x700.jpg",
          JingaChicken:
            "https://cdn.discordapp.com/attachments/650387369706389517/1021124233008529520/unknown.png",
        },
        Burgers: {
          McDonald:
            "https://b.zmtcdn.com/data/pictures/chains/0/20630/a1bb80a3bdb9968b0b937458ae6acfa8.jpg?fit=around|300:273",
          KFC: "https://cdn.discordapp.com/attachments/1018710809360220221/1020012348183949362/unknown.png",
        },
        "Yong Tau Foo": {
          RandomYong_Tau_Foo:
            "https://ewr1.vultrobjects.com/hawkerpedia/article/20210512/4bHCDY9p0D9p_20210408_111319.jpg",
        },
        "Hokkien Mee": {
          RandomHokkienMee:
            "https://sethlui.com/wp-content/uploads/2021/10/Best-Hokkien-Mee-Ah-Hock.jpg",
        },
        "Char Kway Tiao": {
          RandomChar_Kway_Tiao:
            "https://noobcook.com/wp-content/uploads/2014/03/charkwayteow2.jpg",
        },
        Laksa: {
          RandomLaksa:
            "https://rasamalaysia.com/wp-content/uploads/2011/07/curry-laksa-thumb.jpg",
        },
        "Ayam Penyet": {
          RandomAyamPenyet:
            "https://burpple.imgix.net/foods/283117ab7a78753d09e1850511_original.?w=645&dpr=1&fit=crop&q=80&auto=format",
        },
        "Chili Crab": {
          RandomKayaToast:
            "https://img.buzzfeed.com/thumbnailer-prod-us-east-1/video-api/assets/268999.jpg",
        },
        "Kaya Toast": {
          RandomChiliCrab:
            "https://www.thebestsingapore.com/wp-content/uploads/2014/11/best-kaya-toast-596x480.jpg",
        },
        "Dim Sum": {
          RandomDimSum:
            "http://cdn.cnn.com/cnnnext/dam/assets/160325033254-hk-dim-sum-fook-lam-moon.jpg",
        },
        Otah: {
          citysatayOtah:
            "https://citysatay.com/wp-content/uploads/2021/03/BananaLeafOtah.jpg",
        },
        "Ice Kachang": {
          RandomIceKachang:
            "https://singaporelocalfavourites.com/wp-content/uploads/2016/11/ice-kacang.jpg",
        },
        "Curry Puff": {
          RandomCurryPuff:
            "https://christieathome.com/wp-content/uploads/2020/12/Malaysian-Curry-Puffs-18-scaled.jpg",
        },
        Satay: {
          RandomSatay:
            "https://sadia.sg/uploads/recipes/20210802080638-2021-08-02recipes080634_md.jpg",
        },
        Chendol: {
          RandomChendol:
            "https://southeastasiabackpacker.com/wp-content/uploads/2020/11/Cendol-Header.jpg",
        },
        "Roti Prata": {
          RandomRotiPrata:
            "https://sp-ao.shortpixel.ai/client/to_auto,q_glossy,ret_img,w_450,h_300/https://danielfooddiary.com/wp-content/uploads/2020/05/pratasingapore3.jpg",
        },
        Naan: {
          RandomNaan:
            "https://www.budgetbytes.com/wp-content/uploads/2010/09/Homemade-Naan-stack-1.jpg",
        },
        "Tandoori Chicken": {
          RandomTandooriChicken:
            "https://hips.hearstapps.com/hmg-prod.s3.amazonaws.com/images/chicken-tandori-1526595014.jpg",
        },
        "Chicken Masala": {
          RandomChickenMasala:
            "https://static.toiimg.com/thumb/54673639.cms?width=1200&height=900",
        },
        "Fish Head Curry": {
          RandomFishHeadCurry:
            "https://img-global.cpcdn.com/recipes/a82f9bdc6c383ff4/1200x630cq70/photo.jpg",
        },
        "French Fries": {
          RandomFrenchFries:
            "https://static.toiimg.com/thumb/54659021.cms?imgsize=275086&width=800&height=800",
        },
        Pasta: {
          TomatoPasta:
            "https://static.toiimg.com/thumb/52759758.cms?imgsize=560987&width=800&height=800",
        },
        Chawanmushi: {
          RandomSushi:
            "https://www.justonecookbook.com/wp-content/uploads/2022/09/Chawanmushi-9784-I-500x500.jpg",
        },
        Sashimi: {
          RandomSushi:
            "https://www.rd.com/wp-content/uploads/2022/02/GettyImages-1284722254.jpg",
        },
        Sushi: {
          RandomSushi:
            "https://rimage.gnst.jp/livejapan.com/public/article/detail/a/00/00/a0000370/img/basic/a0000370_main.jpg?20201002142956&q=80&rw=750&rh=536",
        },
        "Miso Soup": {
          RandomMisoSoup:
            "https://www.pressurecookrecipes.com/wp-content/uploads/2021/05/miso-soup.jpg",
        },
        Ramen: {
          RandomRamen:
            "https://glebekitchen.com/wp-content/uploads/2017/04/tonkotsuramenfront.jpg",
        },
        "Korean BBQ ": {
          RandomKoreanBBQ:
            "https://iamafoodblog.b-cdn.net/wp-content/uploads/2020/11/korean-bbq-8064w.jpg",
        },
      };
      const frame = document.body.querySelector(".frame");
      for (const [key, value] of Object.entries(data)) {
        console.log(Object.values(value)[0]);
        appendCard(key, Object.values(value)[0]);
      }

      let current = frame.querySelector(".card:last-child");
      let likeText = current.children[0];
      let startX = 0,
        startY = 0,
        moveX = 0,
        moveY = 0;
      initCard(current);

      document.querySelector("#like").onclick = () => {
        moveX = 0.1;
        moveY = 0;
        complete();
      };
      document.querySelector("#hate").onclick = () => {
        moveX = -0.1;
        moveY = 0;
        complete();
      };

      function appendCard(key, value, first = false) {
        const firstCard = frame.children[0];
        const newCard = document.createElement("div");
        newCard.className = "card";
        newCard.dataset.illness = key;
        newCard.style.backgroundImage = `url(${value})`;
        newCard.style.backgroundColor = `#fff`;
        newCard.innerHTML = `
          <div class="is-like"></div>
          <div class="bottom">
            <div class="title mt-auto">
              <span>${key.replaceAll("_", " ")}</span>
            </div>
            <div class="info opacity-0">
              ${value.description}
            </div>
          </div>
        `;
        if (!first) {
          if (firstCard) frame.insertBefore(newCard, firstCard);
          else frame.appendChild(newCard);
        } else {
          frame.appendChild(newCard);
        }
        imgCount++;
      }

      function initCard(card) {
        card.addEventListener("pointerdown", onPointerDown);
      }

      function setTransform(x, y, deg, duration) {
        current.style.transform = `translate3d(${x}px, ${y}px, 0) rotate(${deg}deg)`;
        likeText.style.opacity = Math.abs((x / innerWidth) * 2.1);
        likeText.className = `is-like ${x > 0 ? "like" : "nope"}`;
        if (duration) current.style.transition = `transform ${duration}ms`;
      }

      function onPointerDown({ clientX, clientY }) {
        startX = clientX;
        startY = clientY;
        current.addEventListener("pointermove", onPointerMove);
        current.addEventListener("pointerup", onPointerUp);
        current.addEventListener("pointerleave", onPointerUp);
      }

      function onPointerMove({ clientX, clientY }) {
        moveX = clientX - startX;
        moveY = clientY - startY;
        setTransform(moveX, moveY, (moveX / innerWidth) * 50);
      }

      function onPointerUp() {
        current.removeEventListener("pointermove", onPointerMove);
        current.removeEventListener("pointerup", onPointerUp);
        current.removeEventListener("pointerleave", onPointerUp);
        if (Math.abs(moveX) > frame.clientWidth / 6) {
          current.removeEventListener("pointerdown", onPointerDown);
          complete();
        } else cancel();
      }

      document.getElementById("return").addEventListener("click", () => {
        if (checkCounter == 0) {
          return;
        }
        // document.getElementById("title").style.opacity = 100;
        // document.getElementById("icons").style.opacity = 100;
        // if (document.getElementById("final")) {
        //   document.getElementById("final").remove();
        // }
        frame.children[frame.children.length - 1].removeEventListener(
          "pointerdown",
          onPointerDown
        );
        appendCard(
          Object.entries(data)[checkCounter - 1][0],
          Object.values(Object.entries(data)[checkCounter - 1][1])[0],
          true
        );
        current = frame.querySelector(".card:last-child");
        initCard(frame.children[frame.children.length - 1]);
        checkCounter--;
        console.log(checkCounter);
      });

      function complete() {
        if (checkCounter < Object.entries(data).length) {
          const flyX = (Math.abs(moveX) / moveX) * innerWidth * 1.3;
          const flyY = (moveY / moveX) * flyX;
          likeText = current.children[0];
          setTransform(flyX, flyY, (flyX / innerWidth) * 50, innerWidth);
          const prev = current;
          const next = current.previousElementSibling;
          checkCounter++;
          if (next) {
            initCard(next);
            current = next;
            likeText = next.children[0];
            setTimeout(() => {
              frame.removeChild(prev);
            }, innerWidth);
          }
        }
      }

      function cancel() {
        setTransform(0, 0, 0, 100);
        setTimeout(() => (current.style.transition = ""), 100);
      }
    </script>
  </body>
</html>
